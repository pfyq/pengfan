<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>coach1.html</title>
<script src="../js/base-loading.js"></script><!-- 添加遮蔽层 -->

<link rel="stylesheet" id="easyuiTheme" type="text/css"
    href="../easyui/themes/default/easyui.css">
<link rel="stylesheet" type="text/css" href="../easyui/themes/icon.css">
<link rel="stylesheet" type="text/css" href="../easyui/demo/demo.css">
<script type="text/javascript" src="../easyui/jquery.min.js"></script>
<script type="text/javascript" src="../easyui/jquery.easyui.min.js"></script>
<script type="text/javascript" src="../easyui/locale/easyui-lang-zh_CN.js"></script>

    <script type="text/javascript" src="../js/AllAjax.js"></script>
</head>

<body class="easyui-layout" style="width:100%;height:100%;">
    <table id="tt" class="easyui-datagrid"
        pagination="true"
        data-options="fit:true,singleSelect:true,fitColumns:true"
        title="用户信息展示" iconCls="icon-save" toolbar="#tb">

    </table>
    <!-- 添加工具栏 -->
    <div id="tb">
        <a href="#" id="add" class="easyui-linkbutton" iconCls="icon-add"
            plain="true" onclick="javascript:newItem()">添加</a>
    </div>

    <!--添加 -->
    <div id="dlgAdd" class="easyui-dialog" style="width:400px"
        closed="true" buttons="#toolAdd">
        <form id="fmAdd" method="post" novalidate
            style="margin:0;padding:20px 50px">
            <div style="margin-bottom:10px">
                <input name="real_name" class="easyui-textbox" required="true"
                    label="姓名:" style="width:100%">
            </div>
            <!--<div style="margin-bottom:10px">-->
                <!--<input id="province_add" name="province_id" class="easyui-combobox" valueField='id' textField='name' required="true"-->
                    <!--label="省市:" style="width:100%">-->
            <!--</div>-->
            <!--<div style="margin-bottom:10px">-->
                <!--<input id="city_add" name="city_id" class="easyui-combobox" valueField='id' textField='name' required="true"-->
                    <!--label="市县:" style="width:100%">-->
            <!--</div>-->
             <!--<div style="margin-bottom:10px">-->
                <!--<input name="grade_name" class="easyui-textbox" required="true"-->
                    <!--label="班级:" style="width:100%">-->
            <!--</div>-->
            <div style="margin-bottom:10px">
                <input name="phone" class="easyui-textbox" required="true"
                    label="手机号:" style="width:100%">
            </div>
            <!--<div style="margin-bottom:10px">-->
                <!--<input name="email" class="easyui-textbox" required="true"-->
                    <!--label="邮箱:" style="width:100%">-->
            <!--</div>-->
            <!--<div style="margin-bottom:10px">-->
                <!--<input name="qq" class="easyui-textbox" required="true"-->
                    <!--label="qq:" style="width:100%">-->
            <!--</div>-->
            <!--<div style="margin-bottom:10px">-->
                <!--<input name="blog" class="easyui-textbox" required="true"-->
                    <!--label="微博:" style="width:100%">-->
            <!--</div>-->
            <div style="margin-bottom:10px">
                <input name="name" class="easyui-textbox" required="true"
                    label="账号:" style="width:100%">
            </div>
            <div style="margin-bottom:10px">
                <input name="password" class="easyui-textbox" required="true"
                    label="密码:" style="width:100%">
            </div>
        </form>
    </div>

    <!-- easyui-dialog -->
    <div id="dlgEdit" class="easyui-dialog" style="width:400px"
        closed="true" buttons="#toolEdit">
        <form id="fmEdit" method="post" novalidate
            style="margin:0;padding:20px 50px">
            <div style="margin-bottom:10px;display:none">
                <input name="id" class="easyui-textbox" data-options="required:true"
                    label="主键id:" style="width:100%">
            </div>
            <div style="margin-bottom:10px">
                <input name="real_name" class="easyui-textbox" required="true"
                    label="姓名:" style="width:100%">
            </div>
            <!--<div style="margin-bottom:10px">-->
                <!--<input id="province_edit" name="province_id" class="easyui-combobox" valueField='id' textField='name' required="true"-->
                    <!--label="省市:" style="width:100%">-->
            <!--</div>-->
            <!--<div style="margin-bottom:10px">-->
                <!--<input id="city_edit" name="city_id" class="easyui-combobox" valueField='id' textField='name' required="true"-->
                    <!--label="市县:" style="width:100%">-->
            <!--</div>-->
             <!--<div style="margin-bottom:10px">-->
                <!--<input name="grade_name" class="easyui-textbox" required="true"-->
                    <!--label="班级:" style="width:100%">-->
            <!--</div>-->
            <div style="margin-bottom:10px">
                <input name="phone" class="easyui-textbox" required="true"
                    label="手机号:" style="width:100%">
            </div>
            <!--<div style="margin-bottom:10px">-->
                <!--<input name="email" class="easyui-textbox" required="true"-->
                    <!--label="邮箱:" style="width:100%">-->
            <!--</div>-->
            <!--<div style="margin-bottom:10px">-->
                <!--<input name="qq" class="easyui-textbox" required="true"-->
                    <!--label="qq:" style="width:100%">-->
            <!--</div>-->
            <!--<div style="margin-bottom:10px">-->
                <!--<input name="blog" class="easyui-textbox" required="true"-->
                    <!--label="微博:" style="width:100%">-->
            <!--</div>-->
        </form>
    </div>


    <div id="toolAdd">
        <a id="saveAdd" href="javascript:void(0)" class="easyui-linkbutton c6"
            iconCls="icon-ok" onclick="save('add')" style="width:90px">保存</a> <a
            href="javascript:void(0)" class="easyui-linkbutton"
            iconCls="icon-cancel"
            onclick="javascript:$('#dlgAdd').dialog('close')" style="width:90px">取消</a>
    </div>

    <div id="toolEdit">
        <a id="saveEdit" href="javascript:void(0)"
            class="easyui-linkbutton c6" iconCls="icon-ok" onclick="save('edit')"
            style="width:90px">保存</a> <a href="javascript:void(0)"
            class="easyui-linkbutton" iconCls="icon-cancel"
            onclick="javascript:$('#dlgEdit').dialog('close')" style="width:90px">取消</a>
    </div>

</body>
<script>
  $(function(){
    $("#tt").datagrid({
            url:"../user/us",
            nowrap:false,
            fitColumns:true,
            pagination:true,
            onBeforeLoad :function(param){

            },
            onLoadSuccess:function(d){

            },//从这里添加一个当加载成功后执行的方法,而且替代了前面本身存在的方法
            columns:getColumn("user"),//刷新后台数据    加载columns
        });

  });

  function getColumn(className){
          columns=[];
          array =[];
          //hidden = true
          $.ajax({
               type : "post",
               url : "../user/field",
               data : "className="+className,
               async : false,//取消异步
               success : function(data){
                  $.each(data,function(i,d){
                       if(d.show){
                            array.push({field:""+d.feild+"",title:""+d.fieldText+"",width:'150',align:'center',hidden:true});
                       }else{
                            array.push({field:""+d.feild+"",title:""+d.fieldText+"",width:'150',align:'center'});
                       }
                  });
                  array.push({field:'operate',title:'操作',width:'150',align:'center',formatter:operate});
                  columns.push(array);
                  console.log(columns);
               }
         });
        return columns;
   }

   //添加按钮
   function operate(value, row, index) {
        var str = "<a href='#' name='opera' onclick='javascript:del("
                + row.id + ")' class='easyui-linkbutton' >删除</a>";
            str += "&nbsp;&nbsp;&nbsp;<a href='#' name='opera' onclick='javascript:upd("
                + index + ")' class='easyui-linkbutton' >修改</a>";
        return str;
    }

    function newItem(){
        $('#dlgAdd').dialog('open').dialog('center').dialog('setTitle',
                    '添加信息');
        // $.post('../user/dt?r=' + Math.random(),{},function(data){
        //           $("#province_add").combobox("loadData",data[0]);
        //           var val_d = $("#province_add").combobox('getData');
        //           for ( var item in val_d[0]) {
        //               if (item == 'id') {
        //                     $("#province_add").combobox('select', val_d[0][item]);
        //               }
        //           }
        //           $("#city_add").combobox("loadData",data[1]);
        //            var val_d = $("#city_add").combobox('getData');
        //           for ( var item in val_d[0]) {
        //               if (item == 'id') {
        //                     $("#city_add").combobox('select', val_d[0][item]);
        //               }
        //           }
        // });
        url = '../user/add?r=' + Math.random();
    }


    //删除
    function del(id) {
        $.messager.confirm('信息提示','确定要删除此信息?',function(r){
            if(r){
                $.get("../user/del", {
                    "id" : id
                }, function(data) {
                    if (data == 'success') {
                        $("#tt").datagrid('reload'); // reload the user data
                        $.messager.show({ // show error message
                            title : '提示信息',
                            msg : "删除成功!"
                        });
                    } else {
                        $.messager.show({ // show error message
                            title : '提示信息',
                            msg : "删除失败!"
                        });
                    }
                });
            }

        });


    }
    //修改
    function upd(index) {
        $("#tt").datagrid('selectRow',index);// 关键在这里
        var row = $("#tt").datagrid('getSelected');
        if (row) {
            $('#dlgEdit').dialog('open').dialog('center').dialog('setTitle',
                    '修改信息');
            $('#fmEdit').form('load', row);
            // $.post('../user/dt?r=' + Math.random(),{},function(data){
            //       $("#province_edit").combobox("loadData",data[0]);
            //       $("#province_edit").combobox('select', row.province_id);
            //
            //       $("#city_edit").combobox("loadData",data[1]);
            //       $("#city_edit").combobox('select', row.city_id);
            //  });

            url = '../user/update?r=' + Math.random();
        } else {
            $.messager.show({ // show error message
                title : '提示信息',
                msg : "请选中要修改的行!"
            });
        }
    }
    //保存
    var $submit;
    function save(str){
      var param = null;
      if(str == "add"){
        $submit = $("#fmAdd");
        param = decodeURIComponent($submit.serialize(), true);
        $.messager.confirm('操作确认', '你确认要提交吗?', function(r) {
            submitU(param);
        });
      }else if(str == 'edit'){
        $submit = $("#fmEdit");
        param = decodeURIComponent($("#fmEdit").serialize(), true);
        $.messager.confirm('操作确认', '你确认要提交吗?', function(r) {
            submitU(param);
        });
      }
    }



    function submitU(param){
            $submit.form('submit', {
            url : url,
            data : param,
            onSubmit : function() {
                return $(this).form('validate');//true
            },
            success : function(result) {
                    $('#tt').datagrid('reload'); // reload the user data
                if (result == 'success') {
                    $.messager.show({ // show error message
                        title : '提示信息',
                        msg : "操作成功!"
                    });
                } else {
                    $.messager.show({ // show error message
                        title : '提示信息',
                        msg : "操作失败!"
                    });
                }
                    $('#dlgEdit').dialog('close');
                    $('#dlgAdd').dialog('close');
            }
        });
    }
</script>

</html>
